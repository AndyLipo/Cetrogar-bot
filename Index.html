<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario QR</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>

</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üì¶ Sistema de Inventario QR</h1>
            <p>Gesti√≥n inteligente de mercader√≠a con c√≥digos QR</p>
        </div>

        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showSection('config')">‚öôÔ∏è Configuraci√≥n</button>
            <button class="nav-btn" onclick="showSection('central')">üè¢ Central - Generar QR</button>
            <button class="nav-btn" onclick="showSection('sucursal')">üì± Sucursal - Escanear</button>
        </div>

        <div class="content">
            <!-- Secci√≥n de Configuraci√≥n -->
            <div id="config" class="section active">
                <div class="config-section">
                    <h3>üîß Configuraci√≥n de Google Sheets</h3>
                    <p><strong>Importante:</strong> Para conectar con Google Sheets, necesit√°s configurar la API. Aqu√≠
                        te muestro c√≥mo:</p>

                    <div class="instructions">
                        <h4>Pasos para configurar:</h4>
                        <ol>
                            <li>Cre√° tu Google Sheet con las columnas: Creacion, Fecha de creacion, Mes, Tipo, Remito
                                Pendiente, Remito de Jaula, Crossdocking intersucursales, Estado, Sucursal de origen,
                                Cliente, Estado, Observaciones</li>
                            <li>Hac√© el sheet p√∫blico para edici√≥n o us√° Google Apps Script</li>
                            <li>Copi√° la URL de tu Google Sheet ac√° abajo</li>
                        </ol>
                    </div>

                    <div class="form-group">
                        <label for="scriptUrl">URL de Google App Script:</label>
                        <input type="url" id="scriptUrl"
                            placeholder="https://script.google.com/macros/s/AKfycbzd9jYGOxycQOBKbbTqaqPAy6_Ykx4gJacTRcyv_pQy0cYpYg8-0yE9XEf72ZLNxHaXWg/exec">
                        <small>Esta es la URL de la "Aplicaci√≥n web" que desplegaste desde Google Apps Script.</small>
                    </div>

                    <button class="btn" onclick="saveConfig()">üíæ Guardar Configuraci√≥n</button>
                </div>

                <div class="success-message" id="configSuccess">‚úÖ Configuraci√≥n guardada correctamente</div>
                <div class="error-message" id="configError">‚ùå Error al guardar la configuraci√≥n</div>
            </div>

            <!-- Secci√≥n Central - Generar QR -->
            <div id="central" class="section">
                <h2>üè¢ Central - Cargar Producto y Generar QR</h2>

                <form id="productForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="etiqueta">Etiqueta/Identificador:</label>
                            <input type="text" id="etiqueta" required>
                        </div>
                        <div class="form-group">
                            <label for="fecha">Fecha:</label>
                            <input type="date" id="fecha" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="suc">Sucursal:</label>
                            <input type="text" id="suc" required placeholder="Ej: Sucursal Norte">
                        </div>
                        <div class="form-group">
                            <label for="codAutorizacion">COD Autorizaci√≥n:</label>
                            <input type="text" id="codAutorizacion">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="codigo">C√≥digo de Producto:</label>
                            <input type="text" id="codigo" required>
                        </div>
                        <div class="form-group">
                            <label for="noRemito">N¬∞ Remito:</label>
                            <input type="text" id="noRemito" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="descripcion">Descripci√≥n:</label>
                            <textarea id="descripcion" rows="2" required></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="motivo">Motivo:</label>
                            <input type="text" id="motivo">
                        </div>
                        <div class="form-group">
                            <label for="proveedor">Proveedor:</label>
                            <input type="text" id="proveedor">
                        </div>
                    </div>

                    <button type="submit" class="btn">üì¶ Generar QR y Guardar</button>
                </form>
                <canvas id="canvas" style="display: none;" willReadFrequently="true"></canvas>

                <div id="qrResult" class="qr-display" style="display: none;">
                    <h3>QR Generado</h3>
                    <canvas id="qrCanvas"></canvas>
                    <button class="btn" onclick="downloadQR()">‚¨áÔ∏è Descargar QR</button>
                </div>

                <div class="success-message" id="centralSuccess">‚úÖ Producto guardado y QR generado correctamente</div>
                <div class="error-message" id="centralError">‚ùå Error al guardar el producto</div>
            </div>

            <!-- Secci√≥n Sucursal - Escanear -->
            <div id="sucursal" class="section">
                <h2>üì± Sucursal - Escanear QR</h2>

                <div class="scanner-container">
                    <div class="scanner-info">
                        <strong>üì∑ Instrucciones:</strong><br>
                        Presion√° "Iniciar Scanner" y apunt√° la c√°mara hacia el c√≥digo QR del producto.
                        Los datos se cargar√°n autom√°ticamente al Google Sheet.
                    </div>

                    <button class="btn" id="startScanner" onclick="startScanner()">üì∑ Iniciar Scanner</button>
                    <button class="btn" id="stopScanner" onclick="stopScanner()" style="display: none;">‚èπÔ∏è Detener
                        Scanner</button>

                    <video id="video" style="display: none;"></video>
                    <canvas id="canvas" style="display: none;"></canvas>
                </div>

                <div id="scannedData" style="display: none; margin-top: 30px;">
                    <h3>üìÑ Datos Escaneados</h3>
                    <div id="dataDisplay" class="scanner-info"></div>
                </div>

                <div class="success-message" id="sucursalSuccess">‚úÖ Datos agregados al inventario correctamente</div>
                <div class="error-message" id="sucursalError">‚ùå Error al procesar el c√≥digo QR</div>
            </div>
        </div>
    </div>

    <div id="statusMessage"></div>
    <script src="main.js"></script>
</body>

</html>